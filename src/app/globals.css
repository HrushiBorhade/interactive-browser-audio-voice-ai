@import "tailwindcss";

:root {
  --surface-l: 0;
  --background: oklch(0.97 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.488 0.243 264.376);
  --primary-foreground: oklch(0.97 0.014 254.604);
  --secondary: oklch(0.967 0.001 286.375);
  --secondary-foreground: oklch(0.21 0.006 285.885);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.58 0.22 27);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --radius: 0.625rem;
}

.dark {
  --surface-l: 1;
  --background: oklch(0.13 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.985 0 0);
  --primary-foreground: oklch(0.098 0 0);
  --secondary: oklch(0.2 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.2 0 0);
  --muted-foreground: oklch(0.5 0 0);
  --accent: oklch(0.25 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 8%);
  --input: oklch(1 0 0 / 10%);
  --ring: oklch(0.4 0 0);
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --font-sans: var(--font-dm-sans);
  --font-heading: var(--font-instrument-serif);
  --font-mono: var(--font-geist-mono);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* ==========================================
   Voice Orb
   ========================================== */

@layer components {

  .orb {
    position: relative;
    animation: orb-breathe 5s ease-in-out infinite;
  }

  /* Dashed ring */
  .orb-ring {
    position: absolute;
    inset: -12%;
    border-radius: 50%;
    border: 1px dashed oklch(0.4 0 0 / 20%);
    animation: orb-ring-spin 40s linear infinite;
  }

  /* Atmospheric glow — large, diffuse */
  .orb-glow {
    position: absolute;
    inset: -35%;
    border-radius: 50%;
    background: radial-gradient(
      circle,
      oklch(0.45 0 0 / 28%) 0%,
      oklch(0.35 0 0 / 12%) 40%,
      transparent 70%
    );
    filter: blur(20px);
    animation: orb-glow-pulse 4s ease-in-out infinite;
    transition: opacity 600ms ease, filter 600ms ease, transform 600ms ease;
    will-change: transform;
  }

  /* Main body — morphing container that clips inner layers */
  .orb-body {
    position: absolute;
    inset: 5%;
    overflow: hidden;
    background: oklch(0.1 0 0);
    animation: orb-morph 8s ease-in-out infinite;
    box-shadow:
      0 0 40px oklch(0.55 0 0 / 16%),
      0 0 80px oklch(0.45 0 0 / 8%),
      inset 0 0 40px oklch(0.55 0 0 / 10%);
    transition: box-shadow 600ms ease;
    will-change: border-radius;
  }

  /* Inner layers — drift slowly, overlap for depth */
  .orb-color {
    position: absolute;
    border-radius: 50%;
    transition: opacity 600ms ease;
  }

  .orb-color-1 {
    inset: -25%;
    background: radial-gradient(circle at 30% 25%, oklch(0.35 0 0 / 75%), transparent 65%);
    filter: blur(30px);
    animation: orb-drift-1 12s ease-in-out infinite;
  }

  .orb-color-2 {
    inset: -20%;
    background: radial-gradient(circle at 75% 65%, oklch(0.4 0 0 / 60%), transparent 60%);
    filter: blur(25px);
    animation: orb-drift-2 16s ease-in-out infinite;
  }

  .orb-color-3 {
    inset: -10%;
    background: radial-gradient(circle at 50% 50%, oklch(0.6 0 0 / 65%), transparent 55%);
    filter: blur(18px);
    animation: orb-drift-3 10s ease-in-out infinite;
  }

  /* Luminous core */
  .orb-core {
    position: absolute;
    inset: 18%;
    border-radius: 50%;
    background: radial-gradient(
      circle,
      oklch(0.95 0 0 / 90%) 0%,
      oklch(0.7 0 0 / 40%) 35%,
      transparent 65%
    );
    filter: blur(10px);
    transition: opacity 600ms ease;
  }

  /* Specular highlight — creates 3D lighting */
  .orb-highlight {
    position: absolute;
    top: 12%;
    left: 18%;
    width: 35%;
    height: 30%;
    border-radius: 50%;
    background: radial-gradient(circle, oklch(0.97 0 0 / 22%), transparent 70%);
    filter: blur(10px);
    transition: opacity 600ms ease;
  }

  /* Speaking: pulse rings */
  .orb-pulse {
    position: absolute;
    inset: 0%;
    border-radius: 50%;
    border: 1px solid oklch(0.6 0 0 / 20%);
    opacity: 0;
    pointer-events: none;
    animation: orb-pulse-expand 2.5s ease-out infinite;
    transition: opacity 400ms ease;
  }

  .orb-pulse-delayed {
    animation-delay: 1.25s;
  }

  /* Thinking: rotating shimmer */
  .orb-shimmer {
    position: absolute;
    inset: 2%;
    border-radius: 50%;
    background: conic-gradient(
      from 0deg,
      transparent 0deg,
      oklch(0.6 0 0 / 12%) 45deg,
      oklch(0.5 0 0 / 6%) 90deg,
      transparent 135deg,
      transparent 360deg
    );
    opacity: 0;
    pointer-events: none;
    animation: orb-shimmer-spin 2.5s linear infinite;
    transition: opacity 500ms ease;
  }

  /* ---- State: idle ---- */
  [data-state="idle"] .orb-glow { opacity: 0.4; }
  [data-state="idle"] .orb-body {
    box-shadow:
      0 0 30px oklch(0.45 0 0 / 10%),
      0 0 60px oklch(0.35 0 0 / 5%),
      inset 0 0 30px oklch(0.4 0 0 / 8%);
  }
  [data-state="idle"] .orb-color-1 { opacity: 0.6; }
  [data-state="idle"] .orb-color-2 { opacity: 0.4; }
  [data-state="idle"] .orb-color-3 { opacity: 0.5; }
  [data-state="idle"] .orb-core { opacity: 0.45; }
  [data-state="idle"] .orb-highlight { opacity: 0.35; }

  /* ---- State: listening ---- */
  [data-state="listening"] .orb-glow { opacity: 0.6; }
  [data-state="listening"] .orb-body {
    box-shadow:
      0 0 40px oklch(0.5 0 0 / 15%),
      0 0 80px oklch(0.4 0 0 / 8%),
      inset 0 0 35px oklch(0.5 0 0 / 10%);
  }
  [data-state="listening"] .orb-color-1 { opacity: 0.75; }
  [data-state="listening"] .orb-color-2 { opacity: 0.6; }
  [data-state="listening"] .orb-color-3 { opacity: 0.65; }
  [data-state="listening"] .orb-core { opacity: 0.65; }
  [data-state="listening"] .orb-highlight { opacity: 0.45; }

  /* ---- State: speaking ---- */
  [data-state="speaking"] .orb-glow {
    opacity: 0.9;
    filter: blur(30px);
    transform: scale(1.1);
  }
  [data-state="speaking"] .orb-body {
    box-shadow:
      0 0 60px oklch(0.6 0 0 / 20%),
      0 0 120px oklch(0.5 0 0 / 10%),
      inset 0 0 50px oklch(0.6 0 0 / 14%);
  }
  [data-state="speaking"] .orb-color-1 { opacity: 0.95; }
  [data-state="speaking"] .orb-color-2 { opacity: 0.8; }
  [data-state="speaking"] .orb-color-3 { opacity: 0.85; }
  [data-state="speaking"] .orb-core { opacity: 1; }
  [data-state="speaking"] .orb-highlight { opacity: 0.65; }
  [data-state="speaking"] .orb-pulse { opacity: 1; }

  /* ---- State: thinking ---- */
  [data-state="thinking"] .orb-glow { opacity: 0.45; }
  [data-state="thinking"] .orb-body {
    box-shadow:
      0 0 35px oklch(0.45 0 0 / 12%),
      0 0 70px oklch(0.35 0 0 / 6%),
      inset 0 0 30px oklch(0.45 0 0 / 8%);
  }
  [data-state="thinking"] .orb-color-1 { opacity: 0.65; }
  [data-state="thinking"] .orb-color-2 { opacity: 0.5; }
  [data-state="thinking"] .orb-color-3 { opacity: 0.55; }
  [data-state="thinking"] .orb-core { opacity: 0.55; }
  [data-state="thinking"] .orb-highlight { opacity: 0.35; }
  [data-state="thinking"] .orb-shimmer { opacity: 1; }

  /* ---- Light mode orb overrides ---- */
  :root:not(.dark) .orb-ring {
    border-color: oklch(0.6 0 0 / 20%);
  }
  :root:not(.dark) .orb-glow {
    background: radial-gradient(
      circle,
      oklch(0.55 0 0 / 20%) 0%,
      oklch(0.65 0 0 / 10%) 40%,
      transparent 70%
    );
  }
  :root:not(.dark) .orb-body {
    background: oklch(0.92 0 0);
    box-shadow:
      0 0 40px oklch(0.5 0 0 / 12%),
      0 0 80px oklch(0.6 0 0 / 6%),
      inset 0 0 40px oklch(0.5 0 0 / 8%);
  }
  :root:not(.dark) .orb-color-1 {
    background: radial-gradient(circle at 30% 25%, oklch(0.7 0 0 / 75%), transparent 65%);
  }
  :root:not(.dark) .orb-color-2 {
    background: radial-gradient(circle at 75% 65%, oklch(0.65 0 0 / 60%), transparent 60%);
  }
  :root:not(.dark) .orb-color-3 {
    background: radial-gradient(circle at 50% 50%, oklch(0.5 0 0 / 50%), transparent 55%);
  }
  :root:not(.dark) .orb-core {
    background: radial-gradient(
      circle,
      oklch(0.25 0 0 / 60%) 0%,
      oklch(0.45 0 0 / 30%) 35%,
      transparent 65%
    );
  }
  :root:not(.dark) .orb-highlight {
    background: radial-gradient(circle, oklch(1 0 0 / 30%), transparent 70%);
  }
  :root:not(.dark) .orb-pulse {
    border-color: oklch(0.4 0 0 / 20%);
  }
  :root:not(.dark) .orb-shimmer {
    background: conic-gradient(
      from 0deg,
      transparent 0deg,
      oklch(0.4 0 0 / 12%) 45deg,
      oklch(0.5 0 0 / 6%) 90deg,
      transparent 135deg,
      transparent 360deg
    );
  }

  /* ==========================================
     Architecture Flow
     ========================================== */

  .flow-node {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 3px;
    padding: 10px 20px;
    border-radius: 12px;
    border: 1px solid oklch(var(--surface-l) 0 0 / 8%);
    background: oklch(var(--surface-l) 0 0 / 4%);
    width: 260px;
    transition: border-color 500ms ease, background 500ms ease, box-shadow 500ms ease;
  }

  .flow-node[data-active="true"] {
    border-color: oklch(var(--surface-l) 0 0 / 16%);
    background: oklch(var(--surface-l) 0 0 / 8%);
    box-shadow: 0 0 24px oklch(var(--surface-l) 0 0 / 6%);
  }

  .flow-bridge {
    border-style: dashed;
    border-color: oklch(var(--surface-l) 0 0 / 10%);
    background: oklch(var(--surface-l) 0 0 / 3%);
  }

  .flow-bridge[data-active="true"] {
    border-color: oklch(var(--surface-l) 0 0 / 20%);
    background: oklch(var(--surface-l) 0 0 / 7%);
  }

  .flow-node-sm {
    padding: 8px 16px;
    width: auto;
    border-radius: 10px;
  }

  .flow-line {
    position: relative;
    width: 1px;
    background: oklch(var(--surface-l) 0 0 / 10%);
    overflow: visible;
    transition: background 500ms ease;
  }

  .flow-line[data-active="true"] {
    background: oklch(var(--surface-l) 0 0 / 20%);
  }

  /* Animated data packets — vertical (only when active) */
  .flow-line[data-active="true"]::before,
  .flow-line[data-active="true"]::after {
    content: '';
    position: absolute;
    left: 50%;
    width: 3px;
    height: 3px;
    margin-left: -1.5px;
    border-radius: 50%;
    background: oklch(var(--surface-l) 0 0 / 80%);
    box-shadow: 0 0 6px oklch(var(--surface-l) 0 0 / 50%);
    pointer-events: none;
    animation: flow-packet-down 1.2s ease-in-out infinite;
  }

  .flow-line[data-active="true"]::after {
    animation-delay: 0.6s;
  }

  .flow-line-h {
    position: relative;
    background: oklch(var(--surface-l) 0 0 / 10%);
    overflow: visible;
    transition: background 500ms ease;
  }

  .flow-line-h[data-active="true"] {
    background: oklch(var(--surface-l) 0 0 / 20%);
  }

  /* Animated data packets — horizontal (only when active) */
  .flow-line-h[data-active="true"]::before {
    content: '';
    position: absolute;
    top: 50%;
    width: 3px;
    height: 3px;
    margin-top: -1.5px;
    border-radius: 50%;
    background: oklch(var(--surface-l) 0 0 / 80%);
    box-shadow: 0 0 6px oklch(var(--surface-l) 0 0 / 50%);
    pointer-events: none;
    animation: flow-packet-right 1s ease-in-out infinite;
  }

} /* end @layer components */

/* ---- Keyframes ---- */

@keyframes orb-breathe {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}

@keyframes orb-ring-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes orb-glow-pulse {
  0%, 100% { opacity: 0.6; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.05); }
}

@keyframes orb-morph {
  0%, 100% { border-radius: 42% 58% 58% 42% / 58% 32% 68% 42%; }
  25% { border-radius: 56% 44% 36% 64% / 44% 56% 44% 56%; }
  50% { border-radius: 32% 68% 68% 32% / 52% 48% 32% 68%; }
  75% { border-radius: 64% 36% 44% 56% / 36% 64% 56% 44%; }
}

@keyframes orb-drift-1 {
  0%, 100% { transform: translate(0, 0) scale(1); }
  33% { transform: translate(12%, -15%) scale(1.08); }
  66% { transform: translate(-10%, 10%) scale(0.95); }
}

@keyframes orb-drift-2 {
  0%, 100% { transform: translate(0, 0) scale(1); }
  33% { transform: translate(-15%, 8%) scale(1.05); }
  66% { transform: translate(10%, -12%) scale(0.96); }
}

@keyframes orb-drift-3 {
  0%, 100% { transform: translate(0, 0) scale(1); }
  50% { transform: translate(6%, 8%) scale(1.04); }
}

@keyframes orb-pulse-expand {
  0% { transform: scale(0.95); border-color: oklch(0.6 0 0 / 30%); }
  100% { transform: scale(1.8); border-color: oklch(0.6 0 0 / 0%); }
}

@keyframes orb-shimmer-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* ---- Flow packet keyframes ---- */

@keyframes flow-packet-down {
  0% { top: -2px; opacity: 0; }
  15% { opacity: 1; }
  85% { opacity: 1; }
  100% { top: calc(100% - 1px); opacity: 0; }
}

@keyframes flow-packet-right {
  0% { left: -2px; opacity: 0; }
  15% { opacity: 1; }
  85% { opacity: 1; }
  100% { left: calc(100% - 1px); opacity: 0; }
}

/* ---- Accessibility ---- */

@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
